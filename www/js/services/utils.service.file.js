!function(){"use strict";angular.module("com.helporz.utils.service").service("fileService",["$log",function(e){var r,i,o=function(e,r,i){var o="";switch(i.code){case FileError.QUOTA_EXCEEDED_ERR:o="Storage quota exceeded";break;case FileError.NOT_FOUND_ERR:o="File not found";break;case FileError.SECURITY_ERR:o="Security error";break;case FileError.INVALID_MODIFICATION_ERR:o="Invalid modification";break;case FileError.INVALID_STATE_ERR:o="Invalid state";break;default:o="Unknown error"}console.log("Error ("+e+"): "+o)};this.init=function(o,n){window.requestFileSystem(window.PERSISTENT,0,function(n){e.info("Opened file system: "+n.name),r=n,i=cordova.file.dataDirectory+"files/",o()},function(r){var i="";switch(r.code){case FileError.QUOTA_EXCEEDED_ERR:i="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:i="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:i="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:i="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:i="INVALID_STATE_ERR";break;default:i="Unknown Error"}e.error("Error: "+i),n()})},this.writeToFile=function(r,n,t,l,c){e.debug("write to file dir:"+i+r),window.resolveLocalFileSystemURL(i+r,function(e){e.getFile(n,{create:!0},function(e){e.createWriter(function(e){e.onwriteend=function(e){console.log('Write of file "'+n+'"" completed.')},e.onerror=function(e){console.log("Write failed: "+e.toString())},e.write(t)},o.bind(null,n,c))},o.bind(null,n,c))},o.bind(null,n,c))},this.readFromFile=function(r,n,t,l){var c=i+r+n;window.resolveLocalFileSystemURL(c,function(r){r.file(function(r){var i=new FileReader;i.onloadend=function(r){return e.info("reader onload end,result:"+this.result),t(this.result),this.result},i.readAsText(r)},o.bind(null,n,l))},o.bind(null,n,l))},this.readFileFromFullPath=function(e,r,i){window.resolveLocalFileSystemURL(e,function(n){n.file(function(e){var i=new FileReader;i.onloadend=function(e){return r(this.result),this.result},i.readAsBinaryString(e)},o.bind(null,e,i))},o.bind(null,e,i))};var n=function(r,i,o,t){return"."!=i[0]&&""!=i[0]||(i=i.slice(1)),null==i||0==i.length?(e.info("completed create dir"),void o()):(e.info("folder name:"+i[0]),void r.getDirectory(i[0],{create:!0,exclusive:!1},function(e){i.length&&n(e,i.slice(1),o,t)},t))};this.createDir=function(i,o,t){var l=r;e.info(l.root.baseURI+":"+l.root.toURL()+":"+l.root.toInternalURL()),n(l.root,i.split("/"),o,t)},this.getCDVFileUrl=function(e){return"/"==e.charAt(0)?"cdvfile://localhost/"+r.name+e:"cdvfile://localhost/"+r.name+"/"+e}}]).service("imFileService",["fileService",function(e){this.saveAudioFile=function(r,i,o,n){var t="/im/"+r+"/"+i+"/"+o+".mp3";e.writeToFile(t,n,onSuccess,onFailed)},this.saveImgFile=function(r,i,o,n){var t="/im/"+r+"/"+i+"/"+o+".png";e.writeToFile(t,n,onSuccess,onFailed)},this.getAudioFileUrl=function(r,i,o){return e.getCDVFileUrl("/im/"+r+"/"+i+"/"+o+".mp3")},this.getImgFileUrl=function(r,i,o){return e.getCDVFileUrl("/im/"+r+"/"+i+"/"+o+".png")}}]).service("userImgFileService",["fileService",function(e){this.getUserImgUrl=function(r){return e.getCDVFileUrl("/user/"+r+".png")},this.saveUserImg=function(r,i,o,n){var t=r+".png";e.createDir("user/",function(){e.writeToFile("user/",t,i,o,n)},function(e){var r="";switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:r="Storage quota exceeded";break;case FileError.NOT_FOUND_ERR:r="File not found";break;case FileError.SECURITY_ERR:r="Security error";break;case FileError.INVALID_MODIFICATION_ERR:r="Invalid modification";break;case FileError.INVALID_STATE_ERR:r="Invalid state";break;default:r="Unknown error"}console.log("Error: createDir errCode "+e.code+" msg"+r),n()})}}])}();