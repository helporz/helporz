!function(){"use strict";function e(){Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in t)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length)));return e};var e=function(e){return e.Format("yyyy-MM-dd hh:mm:ss")},t=function(){return e(new Date)},r=function(t){return e(new Date(parseInt(t)))};return{date2String:e,currentDate2String:t,getLocalTime:r}}function t(){var e=function(e){return new Date(e)};return e}function r(e){return{scope:{isFocusMe:"@focusMe"},link:function(t,r){t.$watch("isFocusMe",function(t){null!=t&&""!==t&&"false"!==t&&e(function(){r[0].focus()})})}}}function n(){var e=function(e){var t=new Date(e.replace(/-/g,"/")).getTime(),r=(new Date).getTime(),n=r-t;return n<12e4?"刚才":n<36e5?Math.round(n/6e4)+"分钟前":n<864e5?Math.round(n/36e5)+"小时前":Math.round(n/864e5)+"天前"};return e}function o(){var e;"undefined"!=typeof module&&module.exports&&(e=require("buffer").Buffer);var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=function(e){for(var t={},r=0,n=e.length;r<n;r++)t[e.charAt(r)]=r;return t}(t),n=String.fromCharCode,o=function(e){if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?n(192|t>>>6)+n(128|63&t):n(224|t>>>12&15)+n(128|t>>>6&63)+n(128|63&t)}var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return n(240|t>>>18&7)+n(128|t>>>12&63)+n(128|t>>>6&63)+n(128|63&t)},i=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,c=function(e){return e.replace(i,o)},u=function(e){var r=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0),o=[t.charAt(n>>>18),t.charAt(n>>>12&63),r>=2?"=":t.charAt(n>>>6&63),r>=1?"=":t.charAt(63&n)];return o.join("")},a=function(e){return e.replace(/[\s\S]{1,3}/g,u)},l=e?function(t){return(t.constructor===e.constructor?t:new e(t)).toString("base64")}:function(e){return a(c(e))},s=function(e,t){return t?l(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):l(String(e))},d=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),f=function(e){switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=t-65536;return n((r>>>10)+55296)+n((1023&r)+56320);case 3:return n((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return n((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},g=function(e){return e.replace(d,f)},p=function(e){var t=e.length,o=t%4,i=(t>0?r[e.charAt(0)]<<18:0)|(t>1?r[e.charAt(1)]<<12:0)|(t>2?r[e.charAt(2)]<<6:0)|(t>3?r[e.charAt(3)]:0),c=[n(i>>>16),n(i>>>8&255),n(255&i)];return c.length-=[0,0,2,1][o],c.join("")},h=function(e){return e.replace(/[\s\S]{1,4}/g,p)},v=e?function(t){return(t.constructor===e.constructor?t:new e(t,"base64")).toString()}:function(e){return g(h(e))},m=function(e){return v(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};return{encode:s,decode:m}}function i(e){var t=function(r,n,o){var i=[];if(null==r)return"";if(o>=n)return r.toString();if("string"==typeof r)return'"'+r.replace(/([\'\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+'"';if("object"==typeof r){if(r.sort){for(var c=0;c<r.length;c++)i.push(t(r[c],n,o+1));i="["+i.join()+"]"}else{for(var c in r)i.push(c+":"+t(r[c],n,o+1));document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(r.toString)&&i.push("toString:"+r.toString.toString()),i="{"+i.join()+"}"}return e.debug(i),i}return e.debug(r.toString()),r.toString()},r=function(r,n){"undefined"==typeof n&&null===n||(n=100);var o="";for(var i in r){var c=r[i];o+=i+" = "+t(c,n,0)+"\n"}return e.debug(o),o};return{writeObj:r}}function c(e,t,r){var n=function(e,n,o,i){var c=(t.defer(),new FileUploadOptions);return c.fileKey="file",c.fileName=e.substr(e.lastIndexOf("/")+1),c.mimeType=i,c.headers=o,c.params={framework:"Ionic"},r.upload(encodeURI(n),e,c)},o=function(e,t,r){return n(e,t,r,"image/jpeg")},i=function(e,t,r,n,o){},c=function(e){null!=e&&e.abort()};return{uploadImgFile:o,uploadAudioFile:i,abortUpload:c}}function u(e){var t=function(e,t,r,n,o){var i=new FileTransfer,c=encodeURI(t);return i.download(c,e,function(r){console.log("download complete: "+r.toURL()),n(e,t)},function(r){console.log("download error source "+r.source),console.log("download error target "+r.target),console.log("upload error code"+r.code),o(e,t,r.code)},!1,{headers:r}),i},r=function(e){null!=e&&e.abort()};return{downloadFile:t,abortDownload:r}}angular.module("com.helporz.utils.service",["ngCordova"]).factory("localStorageService",[function(){return{get:function(e,t){var r=localStorage.getItem(e);try{r=angular.fromJson(r)}catch(n){r=null}return null!==r&&0!=r.length||(r=t),r},update:function(e,t){t&&localStorage.setItem(e,angular.toJson(t))},clear:function(e){localStorage.removeItem(e)}}}]).factory("errorCodeService",function(){var e={},t=function(e){return 200==e},r=function(e){return 200==e?"成功":400==e?"未定义错误":403==e?"参数错误":500==e?"服务器内部错误":501==e?"请先登陆":502==e?"上传文件失败":503==e?"用户已经注册":504==e?"无效的序列号":505==e?"无效的登陆令牌":506==e?"无对应记录":507==e?"取消等待任务失败,已经有人接单":508==e?"无效的登陆密码":510==e?"注册用户未验证通过":511==e?"任务超时":512==e?"该求助已不存在":513==e?"该求助已被取消":514==e?"不能接自己发的任务":515==e?"不能取消任务":516==e?"已经提交任务评价":517==e?"无效的任务ID":518==e?"不允许处理任务":519==e?"用户不存在":"未知错误"};return e.isSuccess=t,e.getErrorCodeDescription=r,e}).factory("httpErrorCodeService",function(){var e={},t=function(e){return"网络不给力,请调整后重试:"+e};return e.getErrCodeDescription=t,e.getErrorCodeDescription=t,e}).factory("userLoginInfoService",["localStorageService","utilConvertDateToString",function(e,t){var r=function(t,r){var n={ticket:t,userInfo:r};e.update("userLoginInfo",n)},n=function(){return e.get("userLoginInfo",null)},o=function(){var e=n();return null==e?null:e.ticket},i=function(){var e=n();return null==e?null:e.userInfo.phoneNo},c=function(){e.update("userLoginInfo",null)},u=function(){var r=e.get("showIntroInfo",null);if(null==r||null==r.expireTime)return!0;var n=new Date,o=t.getStringToDate(r.expireTime);return o<n},a=function(){var r=new Date,n=new Date;n.setDate(n.getDate()+2);var o={lastTime:t.getDateToString(r,"yyyy-MM-dd HH:mm:ss"),expireTime:t.getDateToString(n,"yyyy-MM-dd HH:mm:ss")};e.update("showIntroInfo",o)};return{saveLoginInfo:r,getLoginInfo:n,getLoginTicket:o,getLoginPhoneNo:i,clear:c,isShowIntro:u,updateShowIntroInfo:a}}]).factory("deviceService",["$log","pushService",function(e,t){var r={},n=function(){var r={type:2,os:"android",version:"1.0",hid:"111",imsi:"123",serial:""};if("undefined"!=typeof device){r.os=device.platform,r.version=device.version,r.serial=device.serial,e.info("device platform:"+device.platform),"iOS"==r.os?r.type=1:"Android"==r.os?r.type=2:"WinCE"==r.os?r.type=3:r.type=100;var n=t.getCurrentRegistrationID();null!=n&&""!==n?(r.hid=n,e.info("device hid:"+n)):e.error("can't get hid")}else e.error("undefined device");return r};return r.getDeviceInfo=n,r}]).factory("httpBaseService",["$q","$http","$log","$state","$timeout","$ionicLoading","userLoginInfoService","errorCodeService","httpErrorCodeService",function(e,t,r,n,o,i,c,u,a){var l=function(e,r,a,l,s){t({method:"POST",url:appConfig.API_SVC_URL+e,data:r,headers:{"Content-Type":"application/x-www-form-urlencoded","x-login-key":c.getLoginTicket()}}).success(function(e,t,r,c){var s=e;u.isSuccess(s.code)?a(s,t,r,c):501==s.code||510==s.code?(i.hide(),i.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/user-relogin-hit.html"}),o(function(){i.hide(),n.go("login")},3e3)):l(s.code,e,t,r,c)}).error(function(e,t,r,n){s(e,t,r,n)})},s=function(r,l){var s=e.defer();return r=r.indexOf("?")==-1?r+"?_t="+(new Date).getTime():r+"&_t="+(new Date).getTime(),t({method:"POST",url:appConfig.API_SVC_URL+r,data:l,headers:{"Content-Type":"application/x-www-form-urlencoded","x-login-key":c.getLoginTicket()}}).success(function(e,t,r,c){var a=e;u.isSuccess(a.code)?s.resolve(a):501==a.code||510==a.code?(i.hide(),i.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/user-relogin-hit.html"}),o(function(){i.hide(),n.go("login")},3e3)):s.reject(u.getErrorCodeDescription(a.code))}).error(function(e,t){s.reject(a.getErrCodeDescription(t))}),s.promise},d=function(e,r,a,l,s){t({method:"GET",url:appConfig.API_SVC_URL+e,params:r,headers:{"Content-Type":"application/x-www-form-urlencoded","x-login-key":c.getLoginTicket()}}).success(function(e,t,r,c){var s=e;u.isSuccess(s.code)?a(s,t,r,c):501==s.code||510==s.code?(i.hide(),i.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/user-relogin-hit.html"}),o(function(){i.hide(),n.go("login")},3e3)):l(s.code,e,t,r,c)}).error(function(e,t,r,n){s(e,t,r,n)})},f=function(r,l){var s=e.defer();return l=l||{},l._t=(new Date).getTime(),t({method:"GET",url:appConfig.API_SVC_URL+r,params:l,headers:{"Content-Type":"application/x-www-form-urlencoded","x-login-key":c.getLoginTicket()}}).success(function(e,t,r,c){var a=e;u.isSuccess(a.code)?s.resolve(a.data):501==a.code||510==a.code?(i.hide(),i.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/user-relogin-hit.html"}),o(function(){i.hide(),n.go("login")},3e3)):s.reject(u.getErrorCodeDescription(a.code))}).error(function(e,t){s.reject(a.getErrorCodeDescription(t))}),s.promise};return{post:l,get:d,getForPromise:f,postForPromise:s}}]).factory("uploadService",c).factory("downloadService",["$log",u]).factory("UtilsService",e).factory("debugHelpService",["$log",i]).factory("utilConvertDateToString",["$filter",function(e){return{getDateToString:function(t,r){if(angular.isDate(t)&&angular.isString(r))return e("date")(t,r)},getStringToDate:function(e){if(angular.isString(e))return new Date(e.replace(/-/g,"/"))}}}]).constant("base64",o()).filter("DateShow",n).filter("String2Date",t).directive("focusMe",r),e.$inject=[],r.$inject=["$timeout"],c.$inject=["$log","$q","$cordovaFileTransfer"]}();