!function(){"use strict";function e(e,t,i,n,s,c,o,r,a,l,m,u,p){var d=l.vm={};d.selectedPics=[],d.cb_addPic=function(e){console.log("click on imag"+e);o.show({titleText:"请选择图片来源",buttons:[{text:"照相机"},{text:"本地相薄"}],buttonClicked:function(e){if(0==e){var t={quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,mediaType:0,cameraDirection:0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!0};r.getPicture(t).then(function(e){d.selectedPics.push(e),alert("selected:"+e)},function(e){alert("err: camera get picture err="+e)})}else{var t={maximumImagesCount:4,width:800,height:800,quality:80};a.getPictures(t).then(function(e){alert("imgUrls="+e+";imgUrls[0]="+e[0]);for(var t=0;t<e.length;++t)resolveLocalFileSystemURL(e[t],function(e){n.info("image cvd file:"+e.toInternalURL()),alert("internal="+e.toInternalURL()+"native="+e.toNativeURL()),d.selectedPics.length<4&&d.selectedPics.push(e.toNativeURL())})},function(e){alert("err: pick image, err="+e)})}return!0},cancelText:"取消",cancel:function(){},destructiveButtonClicked:function(){}})},d.cb_deletePic=function(e){d.selectedPics.splice(e,1)},d.starScore=0,l.$on("fiveStarChanged",function(e,t){console.log(t),d.starScore=t}),d.commentText="",d.impressUi=p.impressUI(),d.impressIndices=[];var f=function(e){for(var t=(e[0]+1).toString(),i=1;i<e.length;++i)t+=","+(e[i]+1).toString();return t};d.cb_impressSelect=function(e){if(console.log("index:"+d.impressIndices.indexOf(e)),d.impressIndices.indexOf(e)==-1)d.impressIndices.length<3&&(d.impressIndices.push(e),d.impressUi[e].sel=!0);else{var t=d.impressIndices.indexOf(e);d.impressIndices.splice(t,1),d.impressUi[e].sel=null}},l.$on("$ionicView.beforeEnter",function(){var e=t.desc.split("-");d.isAccepter=!0,"accepter"==e[0]?d.isAccepter=!0:"poster"==e[0]?d.isAccepter=!1:console.error("err: not accepter or poster, wrong stateParam"),d.taskId=e[1],d.task=m.cache.acceptTaskList[e[1]]}),d.cb_submit=function(){if(s.show(),d.isAccepter){var t=[];m.commentByAcceptor(d.taskId,d.starScore,d.commentText,f(d.impressIndices),d.selectedPics,t).then(function(t){s.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/remark-success.html"}),i(function(){m.cache.isAcceptTaskGoingNeedRefresh=!0,m.cache.isAcceptTaskFinishNeedRefresh=!0,e.go("main.task")},1500)},function(e){s.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/com-unknown-error.html"})})["finally"](function(){})}else{var t=[];m.commentByPoster(d.taskId,d.starScore,d.commentText,f(d.impressIndices),d.selectedPics,t).then(function(t){s.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/remark-success.html"}),i(function(){m.cache.isPostTaskGoingNeedRefresh=!0,m.cache.isPostTaskFinishNeedRefresh=!0,e.go("main.task")},1500)},function(e){s.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/com-unknown-error.html"})})["finally"](function(){})}}}angular.module("main.comment").controller("mainCommentCtrl",["$state","$stateParams","$timeout","$log","$ionicLoading","$ionicPopup","$ionicActionSheet","$cordovaCamera","$cordovaImagePicker","$scope","taskNetService","taskUtils","impressUtils",e])}();