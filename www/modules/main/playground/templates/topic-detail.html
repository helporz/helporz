<ion-view class="topic-group">

  <ion-nav-title class="title title-center header-item">
    <div style="height: 100%">
      各路大侠一起聊
    </div>
  </ion-nav-title>

  <ion-nav-buttons side="right">
    <button class="button icon ion-ios-star-outline"
            ng-class="{true:'ion-ios-star  collection-color',false:'ion-ios-star-outline'}[vm.collectionTopicService.isCollectionTopic(vm.topicId)]"
            ng-click="vm.collectionToggle($event)">
    </button>

    <button class="button icon ion-ios-more" ng-click="vm.showPopover($event)">
    </button>
  </ion-nav-buttons>
  <ion-content class="has-header topic-group">
    <ion-refresher pulling-text="刷新中" on-refresh="vm.doRefresh()"></ion-refresher>

    <div class="user-topic topic-group-wrapper" ng-click="vm.clearReplyComment()">
      <div class="row">

        <div class="col col-20  col-center">
          <img class="user-logo" ng-src="{{vm.topic.poster.avatar}}">
        </div>

        <div class="col col-center col-66">
          <p class="title-header">
            <span>{{vm.topic.poster.nickname}}</span> <img class="gender-logo"
                                                           ng-src="img/user/gender-{{vm.topic.poster.gender}}.png">
          </p>

          <p class="title-desc">
            {{vm.topic.created|DateShow}} 来自 {{vm.topic.poster.orgList[0].name}}
          </p>
        </div>
        <!--<div class="col  icon ion-chevron-down col-top" style="text-align:center" ng-click="vm.moreOpt(item)"></div>-->
      </div>

      <div class="row content-wrap">
        <p ng-bind-html="vm.topic.content" class="auto-wrap"></p>

      </div>
      <div class="row content-wrap" ng-if="vm.topic.imgList != null || vm.topic.imgList != ''">
        <img class="topics bottom-bordered" ng-repeat="imgSrc in vm.topic.imgList"
             ng-src="{{imgSrc}}" ng-click="vm.showImgs(vm.topic.imgList)">
      </div>

      <div class="row button-list-wrap">
        <div class="col col-32 button-wrap">
          <button class="button button-small icon "
                  ng-class="{true:'ion-ios-heart',false:'ion-ios-heart-outline '}[vm.topic.isFavourite == true]"
                  ng-click="vm.favouriteToggle(vm.topic)" style="color:red">
            {{vm.topic.favouriteCount}}
          </button>

          <!--<button class="button button-small icon " style="color: black"-->
          <!--ng-if="vm.isFavourite(item.id) == false" ng-click="vm.favourite(item.id)">-->
          <!--{{item.favouriteCount}}-->
          <!--</button>-->
        </div>
        <div class="col col-32 button-wrap">
          <button class="button button-small icon ion-ios-redo-outline" ng-click="vm.shareTopic(topic)">分享
          </button>
        </div>
        <div class="col col-32 button-wrap">
          <button class="button button-small icon ion-ios-chatboxes-outline"
                  ng-click="vm.setCommentFocus($event)">
            {{vm.topic.commentCount}}
          </button>
          <!--<button class="button button-small icon ion-ios-chatboxes-outline"-->
          <!--ng-if="item.commentCount == 0 "></button>-->
        </div>

      </div>

    </div>

    <div class="topic-comment topic-group-wrapper" ng-click="vm.clearReplyComment()">
      <div class="row">
        <span>评论{{vm.topic.commentCount}}条</span>
      </div>

      <div class="row" ng-if="vm.topic.commentCount == 0">
        <p>还没有评论，你来试试？</p>
      </div>
      <div class="topic-comment-list">
        <ion-list class="user-topic">
          <ion-item ng-repeat="item in vm.topicCommentList">
            <div class="row">

              <div class="col col-20  col-top">
                <img class="user-logo" ng-src="{{item.commenter.avatar}}">
              </div>

              <div class="col col-center col-66">
                <div class="row">
                  <p class="title-header">
                    <span>{{item.commenter.nickname}}</span> <img class="gender-logo"
                                                               ng-src="img/user/gender-{{item.commenter.gender}}.png">
                  </p>
                </div>
                <div class="row">
                  <p class="title-desc">
                    {{item.created|DateShow}} 来自 {{item.commenter.orgList[0].name}}
                  </p>
                </div>

                <div class="row content-wrap">
                  <p ng-bind-html="item.content" class="auto-wrap"></p>
                </div>

                <div class="row reply-content" ng-if="item.replyOtherComment != null ">
                  <p class="auto-wrap"><span class="auto-wrap"> 回复@{{item.replyOtherComment.commenter.nickname}}的评论:</span>
                    <span ng-bind-html="item.replyOtherComment.content" class="auto-wrap"></span>
                  </p>
                  <a ng-href="#/playground/topic/comment-session/{{item.commentSessionId}}">查看会话</a>
                </div>

              </div>

              <div class="col col-center">
                <div class="icon ion-chatbox-working" ng-click="vm.setReplyCommentFocus(item,$event)"></div>
              </div>
            </div>
            <div class="row">
              <div class="col split nopadding"></div>
            </div>

          </ion-item>
        </ion-list>
      </div>
    </div>


    <ion-infinite-scroll ng-if="vm.moreDataCanBeLoaded()" on-infinite="vm.loadMore()" distance="1%"></ion-infinite-scroll>
  </ion-content>

  <ion-footer-bar align-title="left" class="bar-light" resize-foot-bar>
    <!-- <div class="buttons rj-footer-buttons-left">
        <button class="button button-icon icon ion-ios-mic-outline">
        </button>
    </div> -->
    <div class="col-10">
      <!--<button class="button button-icon icon ion-ios-mic-outline rj-footer-btn-left">-->
      <!--</button>-->
      <div class="icon ion-happy-outline"></div>
    </div>


    <label class="item item-input rj-footer-input col-75">
      <textarea msd-elastic ng-model="vm.sendContent"
                placeholder="{{(vm.replyCommentItem == null)?'输入评论':'回复@'+vm.replyCommentItem.commenter.nickname}}"
                focus-me="{{vm.isComment}}"></textarea>

      <!--<div class="buttons">-->
        <!--<button class="rj-footer-btn button button-icon icon ion-happy-outline"></button>-->
      <!--</div>-->
    </label>

    <div class="rj-footer-btn-wrap">

      <div class="rj-send-button" >
        <p ng-click="vm.sendComment(event)">发送</p>
      </div>
    </div>

  </ion-footer-bar>
</ion-view>
