!function(){"use strict";function e(){var e,t=function(t){e=t},r=function(){return e};return{setPublishModal:t,getPublishModal:r}}function t(e){var t=function(){return e.getForPromise("/playground/topic-group/list",null)},r=function(t,r,o,i){var n={startTopicId:t,pageNum:r,pageSize:o,groupId:i};return e.getForPromise("/playground/topic/list/bygroup",n)},o=function(t,r,o){var i={startTopicId:t,pageNum:r,pageSize:o};return e.getForPromise("/playground/topic/list/byuser",i)},i=function(t,r){var o={pageNum:t,pageSize:r};return e.getForPromise("/playground/topic/collection/list",o)},n=function(t,r,o,i){var n={topicId:t,startCommentId:r,pageNum:o,pageSize:i};return e.getForPromise("/playground/topic/"+t+"/detail",n)},c=function(t,r,o,i){var n={startTopicId:t,pageNum:r,pageSize:o,groupId:i};return e.getForPromise("/playground/systopic/list/bygroup",n)},u=function(t,r,o,i){var n={topicId:t,startCommentId:r,pageNum:o,pageSize:i};return e.getForPromise("/playground/topic-comment/list",n)},a=function(t,r,o){var i={pageNum:r,pageSize:o};return e.getForPromise("/playground/topic-comment/"+t+"/list",i)},p=function(t,r){var o={pageNum:t,pageSize:r};return e.getForPromise("/playground/topic-comment/list/byuser",o)},l=function(t,r){var o={pageNum:t,pageSize:r};return e.getForPromise("/playground/reply-message/list",o)},s=function(t){return e.postForPromise("/playground/topic/"+t+"/favourite",null)},d=function(t){return e.postForPromise("/playground/topic/"+t+"/favourite/cancel",null)},f=function(t){return e.postForPromise("/playground/topic/"+t+"/filter",null)},g=function(t){var r={topicId:t};return e.postForPromise("/playground/topic/blacklist",r)},v=function(t,r,o){var i={topicGroupId:t,topicId:r,commentId:o};return e.postForPromise("/playground/comment/blacklist",i)},m=function(t,r,o,i,n){var c={content:r,commentSessionId:o,replyOtherCommentId:i,replyUserId:n};return e.postForPromise("/playground/topic/"+t+"/comment/add",c)},T=function(t,r,o,i,n){var c=null!=n&&0!=n.length?JSON.stringify(n):null,u={groupId:t,content:r,imgCount:o,audioCount:i,tagList:c};return e.postForPromise("/playground/topic/add",u)},h=function(t){var r={topicId:t};return e.postForPromise("/playground/topic/collection",r)},I=function(t){var r={topicId:t};return e.postForPromise("/playground/topic/collection/cancel",r)},y=function(){return e.getForPromise("/playground/topic/tags",null)},S=function(){return e.getForPromise("/playground/adList",null)};return{getTopicGroupList:t,getTopicListByGroup:r,getOwnTopicListByUser:o,getCollectionTopicListByUser:i,getSysTopicListByGroup:c,getTopicDetailInfo:n,getTopicCommentList:u,getTopicCommentListBySessionId:a,getTopicCommentListByUser:p,getReplyMessageListByUserId:l,favouriteTopic:s,cancelFavouriteTopic:d,filterTopic:f,addTopic2Blacklist:g,addComment2Blacklist:v,addTopicComment:m,addTopic:T,addCollectionTopic:h,cancelCollectionTopic:I,getTopicTagList:y,getAdList:S}}function r(e,t,r){var o={filterTopic:{topicId:"0",userId:"0",groupId:"0",topicCreate:null},favouriteTopic:{topicId:"0",userId:"0",groupId:"0",topicCreate:null},topicBlacklist:{topicId:"0",userId:"0",groupId:"0",topicCreate:null},collectionTopic:{topicId:"0",userId:"0",groupId:"0",topicCreate:null}},i=function(){var t=["CREATE TABLE IF NOT EXISTS filterTopic(topicId text, userId text,groupId text,topicCreate text)","CREATE TABLE IF NOT EXISTS favouriteTopic(topicId text, userId text,groupId text,topicCreate text)","CREATE TABLE IF NOT EXISTS topicBlacklist(topicId text, userId text,groupId text,topicCreate text)","CREATE TABLE IF NOT EXISTS collectionTopic(topicId text, userId text,groupId text,topicCreate text)"];r.executeSqlList(t).then(function(){e.info("create playground tables success")},function(t){e.error("create playground tables error: "+t.message)})},n=function(t,i){var n=o[t];return null==n||""==n?(e.error("invalid table name"),null):r.createRow(t,i,n)},c=function(t){var i=o[t];return null==i||""==i?(e.error("invalid table name"),null):r.createRow(t,null,i)},u=function(e,t){var i=o[e];if(null==i||""==i)throw"invalid table name";return r.saveRecords(e,t,i)},a=function(e,o){var i=t.defer();return r.findRecords(e,o).then(function(t){if("undefined"==typeof t||null===t)return void i.resolve(new Array);var r=new Array;if(t.rows.length)for(var o=0;o<t.rows.length;++o){var c=n(e,t.rows.item(o));null!=c&&r.push(c)}i.resolve(r)},function(e){i.reject(e)}),i.promise},p=function(e,t){return r.dropRecords(e,t)};return{createTable:i,createRecord:c,saveRecords:u,findRecords:a,dropRecords:p}}function o(e,t,r,o,i){var n=new r([],(!0)),c="",u=function(t){o.findRecords("filterTopic",'userId = "'+t+'"').then(function(e){for(var r=0;r<e.length;++r){var o=e[r];n.put(o.topicId,o)}c=t},function(t){e.error("create topic filter cache from db failed:"+t.message)})},a=function(r,u,a){var p=t.defer();return i.filterTopic(r).then(function(t){var i=o.createRecord("filterTopic");i.topicId=r,i.groupId=u,i.userId=c,i.topicCreate=a,o.saveRecords("filterTopic",i).then(function(e){n.put(r,i),p.resolve(r)},function(t){e.error("向数据库中添加过滤话题失败:"+t.message),p.reject(t)})},function(t){e.error("向服务器发生添加过滤话题失败:"+t.message),p.reject(t)}),p.promise},p=function(e){var t=n.get(e);return null!=t&&""!=t};return{buildCacheFromDB:u,addFilterTopic:a,isFilterTopic:p}}function i(e,t,r,o,i){var n=new r([],(!0)),c="",u=function(t){o.findRecords("favouriteTopic",'userId = "'+t+'"').then(function(e){for(var r=0;r<e.length;++r){var o=e[r];n.put(o.topicId,o)}c=t},function(t){e.error("create favourite topic cache from db failed:"+t.message)})},a=function(r,u,a){var p=t.defer();return i.favouriteTopic(r).then(function(t){var i=o.createRecord("favouriteTopic");i.topicId=r,i.groupId=u,i.userId=c,i.topicCreate=a,o.saveRecords("favouriteTopic",i).then(function(e){n.put(r,i),p.resolve(r)},function(t){e.error("向数据库中添加点赞话题失败:"+t.message),p.reject(t)})},function(t){e.error("向服务器发送添加点赞话题失败:"+t.message),p.reject(t)}),p.promise},p=function(r,u,a){var p=t.defer();return i.cancelFavouriteTopic(r).then(function(t){o.dropRecords("favouriteTopic",'topicId = "'+r+'" and userId = "'+c+'"').then(function(e){n.remove(r),p.resolve(r)},function(t){e.error("从数据库中删除点赞话题失败:"+t.message),p.reject(t)})},function(t){e.error("向服务器发送去掉点赞请求失败:"+t.message),p.reject(t)}),p.promise},l=function(e){var t=n.get(e);return null!=t&&""!=t};return{buildCacheFromDB:u,addFavouriteTopic:a,deleteFavouriteTopic:p,isFavouriteTopic:l}}function n(e,t,r,o,i){var n=new r([],(!0)),c="",u=function(t){o.findRecords("collectionTopic",'userId = "'+t+'"').then(function(e){for(var r=0;r<e.length;++r){var o=e[r];n.put(o.topicId,o)}c=t},function(t){e.error("create collectionTopic topic cache from db failed:"+t.message)})},a=function(r,u){var a=t.defer();return i.addCollectionTopic(r).then(function(t){var i=o.createRecord("collectionTopic");i.topicId=r,i.userId=c,i.topicCreate=u,o.saveRecords("collectionTopic",i).then(function(e){n.put(r,i),a.resolve(r)},function(t){e.error("向数据库中添加收藏话题失败:"+t.message),a.reject(t)})},function(t){e.error("向服务器发送添加收藏话题失败:"+t.message),a.reject(t)}),a.promise},p=function(r,u,a){var p=t.defer();return i.cancelCollectionTopic(r).then(function(t){o.dropRecords("collectionTopic",'topicId = "'+r+'" and userId = "'+c+'"').then(function(e){n.remove(r),p.resolve(r)},function(t){e.error("从数据库中删除收藏话题失败:"+t.message),p.reject(t)})},function(t){e.error("向服务器发送去掉收藏请求失败:"+t.message),p.reject(t)}),p.promise},l=function(e){var t=n.get(e);return null!=t&&""!=t};return{buildCacheFromDB:u,addCollectionTopic:a,cancelCollectionTopic:p,isCollectionTopic:l}}function c(e,t,r,o,i){var n=new r([],(!0)),c="",u=function(t){o.findRecords("topicBlacklist",'userId = "'+t+'"').then(function(e){for(var r=0;r<e.length;++r){var o=e[r];n.put(o.topicId,o)}c=t},function(t){e.error("create topic blacklist cache from db failed:"+t.message)})},a=function(r,u,a){var p=t.defer();return i.addTopic2Blacklist(r).then(function(t){var i=o.createRecord("topicBlacklist");i.topicId=r,i.groupId=u,i.userId=c,i.topicCreate=a,o.saveRecords("topicBlacklist",i).then(function(e){n.put(r,i),p.resolve(r)},function(t){e.error("向数据库中添加话题黑名单失败:"+t.message),p.reject(t)})},function(t){e.error("向服务器发生添加话题黑名单失败:"+t.message),p.reject(t)}),p.promise},p=function(e){var t=n.get(e);return null!=t&&""!=t};return{buildCacheFromDB:u,addTopicBlacklist:a,isInTopicBlacklist:p}}function u(e,t,r,o,i,n,c,u,a){var p=new r([],(!0)),l=new r([],(!0)),s=null,d=null,f=function(){B(),F()},g=function(e){return e.isShow=!0,e.isFavourite=!1,1==c.isInTopicBlacklist(e.id)&&(e.isShow=!1),1==u.isFilterTopic(e.id)&&(e.isShow=!1),1==n.isFavouriteTopic(e.id)&&(e.isFavourite=!0),e},v=function(e){var r=t.defer();return i.getSysTopicListByGroup(0,1,10,e).then(function(t){for(var o=new Array,i=0;i<t.length;++i)o.push(g(t[i]));l.put(e,o),r.resolve(o)},function(e){r.reject(e)}),r.promise},m=function(e){var r=t.defer();return i.getTopicListByGroup(0,1,10,e).then(function(t){for(var o=new Array,i=0;i<t.length;++i)o.push(g(t[i]));p.put(e,o),r.resolve(o)},function(e){r.reject(e)}),r.promise},T=function(e){var r=p.get(e),o=t.defer();if(null==r||0==r.length)return m(e);var n=r[0],c=r[r.length-1],u=20;return i.getTopicListByGroup(n.id,Math.ceil(r.length/u)+1,u,e).then(function(e){for(var t=e.length,i=0;i<t&&!(c.id<=e[i].id);++i)r.push(g(e[i]));o.resolve(r)},function(e){o.reject(e)}),o.promise},h=function(e){return l.get(e)},I=function(e){return p.get(e)},y={},S=function(e){y=e},b=function(){return y},C=function(e){a.shareTopic(e.id,1).then(function(t){e.shareCount++},function(e){})},B=function(){return null!=s&&0!=s.length||i.getTopicTagList().then(function(e){s=e},function(t){e.error("getTopicTagList faile:"+t)}),s},F=function(){return null!=d&&0!=d.length||i.getAdList().then(function(e){d=e},function(t){e.error("getAddList failed:"+t)}),d},P=[],$=function(e){P=e},L=function(){return P};return{initService:f,setCurrentDetailTopic:S,getCurrentDetailTopic:b,setCurrentDetailTopicCommentList:$,getCurrentDetailTopicCommentList:L,refreshSysTopic:v,refreshTopic:m,moreTopic:T,getSysTopicList:h,getTopicList:I,shareTopic:C,getTopicTagList:B,getADList:F}}function a(e,t,r,o){var i=[{id:1,name:"捎带侠论坛",description:"捎带侠们聚集起来",publicNotice:"1.捎带侠们聚集起来<br/> 2.捎带侠们聚集起来 <br/>  3.2.捎带侠们聚集起来 ",pic:"img/task/publish/shaodai-logo.png"},{id:2,name:"情报侠论坛",description:"情报侠们聚集起来",publicNotice:"1.捎带侠们聚集起来<br/> 2.捎带侠们聚集起来 <br/>  3.2.捎带侠们聚集起来 ",pic:"img/task/publish/qingbao-logo.png"},{id:3,name:"借宝侠论坛",description:"借宝侠们聚集起来",publicNotice:"1.捎带侠们聚集起来<br/> 2.捎带侠们聚集起来 <br/>  3.2.捎带侠们聚集起来 ",pic:"img/task/publish/jiebao-logo.png"},{id:1,name:"捎带侠论坛",description:"捎带侠们聚集起来",publicNotice:"1.捎带侠们聚集起来<br/> 2.捎带侠们聚集起来 <br/> 3.2.捎带侠们聚集起来 ",pic:"img/task/publish/shaodai-logo.png"},{id:2,name:"情报侠论坛",description:"情报侠们聚集起来",publicNotice:"1.捎带侠们聚集起来<br/> 2.捎带侠们聚集起来 <br/> 3.2.捎带侠们聚集起来 ",pic:"img/task/publish/qingbao-logo.png"},{id:3,name:"借宝侠论坛",description:"借宝侠们聚集起来",publicNotice:"捎带侠们聚集起来 捎带侠们聚集起来 ",pic:"img/task/publish/jiebao-logo.png"},{id:1,name:"捎带侠论坛",description:"捎带侠们聚集起来",publicNotice:"捎带侠们聚集起来 捎带侠们聚集起来 ",pic:"img/task/publish/shaodai-logo.png"},{id:2,name:"情报侠论坛",description:"情报侠们聚集起来",publicNotice:"捎带侠们聚集起来 捎带侠们聚集起来 ",pic:"img/task/publish/qingbao-logo.png"},{id:3,name:"借宝侠论坛",description:"借宝侠们聚集起来",publicNotice:"捎带侠们聚集起来 捎带侠们聚集起来 ",pic:"img/task/publish/jiebao-logo.png"}],n=function(){},c=function(e){return i[e]},u=function(){return i};return{refresh:n,getGroupInfo:c,getGroupInfoList:u}}function p(e,t,r,o,i){var n=function(n){t.createTable(),e.initService(),r.buildCacheFromDB(n),o.buildCacheFromDB(n),i.buildCacheFromDB(n)};return{initService:n}}angular.module("com.helporz.playground").factory("PlaygroundNetService",t).factory("PlaygroundDBService",r).factory("favouriteTopicService",i).factory("collectionTopicService",n).factory("topicBlacklistService",c).factory("topicService",u).factory("topicGroupService",a).factory("topicModalService",e).factory("filterTopicService",o).factory("PlaygroundStartupService",p),e.$inject=[],t.$inject=["httpBaseService"],r.$inject=["$log","$q","dbService"],o.$inject=["$log","$q","$$HashMap","PlaygroundDBService","PlaygroundNetService"],i.$inject=["$log","$q","$$HashMap","PlaygroundDBService","PlaygroundNetService"],n.$inject=["$log","$q","$$HashMap","PlaygroundDBService","PlaygroundNetService"],c.$inject=["$log","$q","$$HashMap","PlaygroundDBService","PlaygroundNetService"],u.$inject=["$log","$q","$$HashMap","PlaygroundDBService","PlaygroundNetService","favouriteTopicService","topicBlacklistService","filterTopicService","SharePageWrapService"],a.$inject=["$log","$q","$$HashMap","PlaygroundNetService"],p.$inject=["topicService","PlaygroundDBService","favouriteTopicService","topicBlacklistService","filterTopicService"]}();