!function(){"use strict";function e(){return{user:{id:"",nickname:""},tasks:[]}}function t(e,t,i,s,a,n,r,c,o,l,m,u,k,f,d,g,p,T,h){function v(){i.show(),t.debug("mainUserTasksService:"+JSON.stringify(d)),c.getWaitingTaskList(d.user.id).then(y,U)["finally"](function(){i.hide()})}function y(e){n.vm.items=e,d.tasks=e;for(var t=0;t<n.vm.items.length;t++){var i=n.vm.items[t];i.icon=l.iconByTypeValue(i.taskTypesId),i.typeName=l.nameByTypeValue(i.taskTypesId),i.commentCount=i.commentList?i.commentList.length:0,i.ui_isMyTask=o.cache.selfInfo.userId==i.poster.userId;var s=i.created.split(/[\:\-\s]/);6!=s.length&&alert("network err: task created time is not valid");var r=new Date(s[0],parseInt(s[1])-1,s[2],s[3],s[4],s[5]);i.ui_createTime=m.formatSimpleTimeBeforeNow(r),i.ui_tags=[],u.netTagsToUiTags(i.ui_tags,i.poster.tags)}a(function(){n.$apply()})}function U(e){alert(e)}var $=n.vm={};t.debug("mainUserTaskCtrl:"+JSON.stringify(r)),d.user.id=r.userId,d.user.nickname=r.nickname,$.nickname=d.user.nickname,$.items=[],$.sharePageService=f,$.doRefresh=function(){t.debug("mainUserTasksService:"+JSON.stringify(d)),c.getWaitingTaskList(d.user.id).then(y,U)["finally"](function(){n.$broadcast("scroll.refreshComplete")})},n.$on("$ionicView.enter",function(){0==d.tasks.length?v():$.items=d.tasks}),n.$on("$ionicView.leave",function(){}),$.cb_gotoUser=function(e){if(0!=p.canClick()){var t,i=h.$getByHandle("rootTabs").selectedIndex();0==i?t="near":4==i?t="me":ho.alert("gotoUser tab invalid, tabIndex="+i),T.gotoUser(e,t)}},$.cb_itemClick=function(e){0!=p.canClick()&&(g.task=$.items[e],T.gotoTaskDetail("-1"))},$.cb_acceptTask=function(e){if(0!=p.canClick()){var t=$.items[e];i.show(),c.acceptTask(t.id).then(function(e){200==e.code?(i.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/task-accept-success.html"}),a(function(){c.cache.isNearTaskNeedRefresh=!0,c.cache.isAcceptTaskGoingNeedRefresh=!0,v()},1500)):(i.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/task-not-exist.html"}),a(function(){c.cache.isNearTaskNeedRefresh=!0},1500))},function(){})["finally"](function(){console.log("accept taskid="+t.id)})}}}angular.module("main.user-tasks").factory("mainUserTasksService",e).controller("mainUserTasksCtrl",["$state","$log","$ionicLoading","$interval","$timeout","$scope","$stateParams","taskNetService","userNetService","taskUtils","timeUtils","impressUtils","intervalCenter","SharePageWrapService","mainUserTasksService","mainNearTaskDetailService","operationUtils","userUtils","$ionicTabsDelegate",t])}();