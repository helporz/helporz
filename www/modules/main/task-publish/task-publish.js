!function(){"use strict";function e(){var e=null,t=null,s=function(t){e=t},i=function(){return e},l=function(e){t=e},o=function(){return t};return{setListModal:s,getListModal:i,setTaskPublishModal:l,getTaskPublishModal:o}}function t(e,t,s){e.state("publish-list",{url:"/task/publish/list",templateUrl:"modules/main/task-publish/test-list.html",controller:"testTaskPublishController"}).state("task-publish",{url:"/task/publish/post",templateUrl:"modules/main/task-publish/task-publish.html",controller:"taskPublishController"})}function s(e,t,s,i,l){s.fromTemplateUrl("modules/main/task-publish/modal-list.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.publishListModal=t,l.setListModal(t)}),e.showPublishList=function(){e.publishListModal.show()}}function i(e,t,s,i,o,a,n){s.fromTemplateUrl("modules/main/task-publish/task-publish.html",{scope:e,animation:"slide-in-up"}).then(function(e){i.setTaskPublishModal(e)}),this.cancel=function(){var e=i.getListModal();e&&e.hide()},this.publishShaodai=function(){l(e,0,i,o,a,n)},this.publishQingbao=function(){l(e,1,i,o,a,n)},this.publishJiebao=function(){l(e,2,i,o,a,n)}}function l(e,t,s,i,l,o){var n=s.getListModal();e.taskTypeIndex=t,e.subTaskArray=a(i,l,e.taskTypeIndex),e.publishTaskTypeName=l[e.taskTypeIndex].name,0==t?e.taskLogo="./img/task/publish/shaodai-logo.png":1==t?e.taskLogo="./img/task/publish/qingbao-logo.png":2==t&&(e.taskLogo="./img/task/publish/jiebao-logo.png");var u=s.getTaskPublishModal();n.hide(),u.show()}function o(e){e.startTime=e.deadline=e.summary=e.pubLocation=null,e.selectedRewardType=e.selectedSubRewardType=0,e.startTimeShow=e.deadlineShow=null}function a(e,t,s){for(var i=new Array,l=t[s].subtype,o=0;o<l.length;++o){var a=l[o],n={};n.index=o,n.type=e.typeValue(s,o),n.name=a.name,n.holder=a.holder,n.icon=e.iconByTypeValue(n.type),i.push(n)}return i}function n(e,t,s,i,l,a,n,c,d,p,h,m){var b=this;this.setRewardType=function(e,t){b.selectedRewardType=e,b.selectedSubRewardType=t},this.closeModal=function(){var t=d.getTaskPublishModal();t.hide(),o(b),e.selectedSubTask=null},this.deadline=null,this.startTime=null,this.setStartTime=function(e){e.preventDefault();var s=new Date,i={date:s,mode:"datetime"};c.show(i).then(function(e){e-s<0?alert("需要设置晚于当前时间的日期"):null!=b.deadline&&b.deadline-e<0?alert("开始时间要设置早于截止时间"):(b.startTime=e,t.info("set start time:"+e),b.startTimeShow=u(e))},function(e){alert(e)})},this.setDeadline=function(e){e.preventDefault();var s=new Date,i={date:s,mode:"datetime"};c.show(i).then(function(e){e-s<0?alert("需要设置晚于当前时间的日期"):null!=b.startTime&&b.startTime-e>0?alert("截止时间要设置晚于开始时间"):(b.deadline=e,t.info("set deadline:"+e),b.deadlineShow=u(e))},function(e){alert(e)})},this.selectedSubType=function(t){e.selectedSubTask=e.subTaskArray[t],b.popup.close()},this.cancelSelectSubType=function(){b.popup.close()},this.selectSubTaskType=function(){var t=e.$new();t.subTypeList=e.subTaskArray,t.selectedSubType=b.selectedSubType,t.cancel=b.cancelSelectSubType,t.typeName=e.publishTaskTypeName,b.popup=i.show({templateUrl:"modules/main/task-publish/select-subtype-popup.html",title:null,subTitle:null,scope:t})},this.publish=function(){function t(){function t(e){alert("123")}function s(){var e=i.$el[0].querySelector("#task-publish-success-popup");e.style.opacity="0",i.hide(),b.closeModal(),p.cache.isPostTaskGoingNeedRefresh=!0,p.cache.isNearTaskNeedRefresh=!0}var i,o=e.$new();o.share=t,o.close=s,l.fromTemplateUrl("modules/main/task-publish/publish-success-popup.html",{title:null,subTitle:null,scope:o}).then(function(e){i=e,i.show();var t=i.$el[0].querySelector("#task-publish-success-popup");n(function(){t.style.opacity="1"})})}return 1==g_isDebug&&(b.startTime=new Date,b.deadline=new Date,b.startTime.setMonth(b.startTime.getMonth()+1),b.deadline.setMonth(b.deadline.getMonth()+2)),0==ho.isValid(e.selectedSubTask)||0==ho.isValid(e.selectedSubTask.type)?void a.show({duration:1500,template:"请选择求助类别"}):0==ho.isValid(b.summary)||""===b.summary?void a.show({duration:1500,template:"请输入求助内容"}):0==ho.isValid(b.pubLocation)||""===b.pubLocation?void a.show({duration:1500,template:"请输入见面地址"}):0==ho.isValid(b.deadline)?void a.show({duration:1500,template:"请选择截止时间"}):0==ho.isValid(b.selectedRewardType)||0==ho.isValid(b.selectedSubRewardType)?void a.show({duration:1500,template:"请选择感谢方式"}):(a.show(),void p.postTask(e.selectedSubTask.type,b.summary,b.pubLocation,r(b.startTime),r(b.deadline),0,0,b.selectedRewardType,b.selectedSubRewardType,1,0).then(function(){a.hide(),t()},function(e){a.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/com-network-error.html"})}))}}function u(e){if(null==e)return null;var t=e.getFullYear(),s=e.getMonth()+1,i=e.getDate(),l=(e.getDay(),e.getHours()),o=e.getMinutes(),a=(e.getSeconds(),e.getMilliseconds(),t);return a=s>9?a+"年"+s:a+"年0"+s,a=i>9?a+"日"+i:a+"日0"+i,a=l>9?a+" "+l:a+" 0"+l,a=o>9?a+":"+o:a+":0"+o}function r(e){if(null==e)return null;var t=e.getFullYear(),s=e.getMonth()+1,i=e.getDate(),l=(e.getDay(),e.getHours()),o=e.getMinutes(),a=e.getSeconds(),n=(e.getMilliseconds(),t);return n=s>9?n+"/"+s:n+"/0"+s,n=i>9?n+"/"+i:n+"/0"+i,n=l>9?n+" "+l:n+" 0"+l,n=o>9?n+":"+o:n+":0"+o,n=a>9?n+":"+a:n+":0"+a}angular.module("com.helporz.task.publish",["ionic","com.helporz.task.netservice","ngCordova.plugins.datePicker","app.task.utils.service"]).config(t).controller("testTaskPublishController",s).controller("taskPublishController",n).controller("taskPublishListController",i).factory("taskPublishModalService",e),t.$inject=["$stateProvider","$urlRouterProvider","$ionicConfigProvider"],s.$inject=["$scope","$log","$ionicModal","$ionicPopup","taskPublishModalService"],i.$inject=["$scope","$log","$ionicModal","taskPublishModalService","taskUtils","taskDesc","$timeout"],n.$inject=["$scope","$log","$ionicModal","$ionicPopup","$ionicPopover","$ionicLoading","$timeout","$cordovaDatePicker","taskPublishModalService","taskNetService","taskUtils","taskDesc"]}();