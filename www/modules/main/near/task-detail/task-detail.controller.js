!function(){"use strict";function t(){return{task:{}}}function e(t,e,a,s,n,o,i,c,r,l,m,u,d,k,p,f){console.log(i);var h=e.vm={};h.sharePageService=d,e.$on("$ionicView.beforeEnter",function(){h.task=c.getTaskInNearList(i.id),0==ho.isValid(h.task)&&(h.task=c.getTaskInPostList(i.id)),0==ho.isValid(h.task)&&(h.task=k.task),h.task.icon=r.iconByTypeValue(h.task.taskTypesId),h.task.typeName=r.nameByTypeValue(h.task.taskTypesId),h.task.commentCount=h.task.commentList?h.task.commentList.length:0;var t=l.cache.selfInfo.userId;for(var a in h.task.commentList){var s=h.task.commentList[a],n=s.created.split(/[\:\-\s]/);6!=n.length&&alert("network err: task created time is not valid");var d=new Date(n[0],parseInt(n[1])-1,n[2],n[3],n[4],n[5]);s.ui_createTime=u.formatSimpleTimeBeforeNow(d),s.ui_isMyTask=h.task.poster.userId==t,s.ui_canContact=h.task.poster.userId==t&&s.commentator!=t}h.task.ui_tags=[],m.netTagsToUiTags(h.task.ui_tags,h.task.poster.tags),h.ui_taskAccepte=!1,o(function(){e.$apply()},0)}),h.cb_gotoUser=function(t){var e,a=f.$getByHandle("rootTabs").selectedIndex();0==a?e="near":4==a?e="me":ho.alert("gotoUser tab invalid, tabIndex="+a),p.gotoUser(t,e)},h.cb_acceptTask=function(){return null==l.cache.selfInfo?void alert("未登录"):l.cache.selfInfo.userId==h.task.poster.userId?void s.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/task-cannot-accept-self-post.html"}):(s.show(),void c.acceptTask(h.task.id).then(function(e){console.log(e),200==e.code?(c.cache.isNearTaskNeedRefresh=!0,c.cache.isAcceptTaskGoingNeedRefresh=!0,s.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/task-accept-success.html"}),o(function(){t.go("main.near")},1500)):(c.cache.isNearTaskNeedRefresh=!0,s.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/task-not-exist.html"}))},function(e){s.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/task-not-exist.html"}),o(function(){t.go("main.near")},1500)})["finally"](function(){}))},h.input="",h.viewScroll=a.$getByHandle("taskDetailScroll"),window.addEventListener("native.keyboardshow",function(t){}),h.testShow=function(){ionic.trigger("native.keyboardshow")},h.testHide=function(){ionic.trigger("native.keyboardhide")},h.send=function(){s.show(),c.commentTask(h.task.id,h.input).then(function(e){if(console.log(e),200==e.code){h.input="";var a=e.data;h.ui_taskAccepted=0!=a.status,h.ui_canContact=a.poster.userId==l.cache.selfInfo.userId,h.task.commentList=a.commentList,h.task.commentCount=h.task.commentList.length,s.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/comment-success.html"})}else s.show({duration:1500,templateUrl:"modules/components/templates/ionic-loading/task-not-exist.html"}),o(function(){t.go("main.near")},1500)},function(t,e){n.alert({title:"错误提示",template:t.data.message}).then(function(e){console.error(t)}),h.input="发送中产生错误",s.hide()})["finally"](function(){})},h.cb_contact=function(){}}angular.module("main.near.taskdetail").factory("mainNearTaskDetailService",t).controller("mainNearTaskDetailCtrl",["$state","$scope","$ionicScrollDelegate","$ionicLoading","$ionicPopup","$timeout","$stateParams","taskNetService","taskUtils","userNetService","impressUtils","timeUtils","SharePageWrapService","mainNearTaskDetailService","userUtils","$ionicTabsDelegate",e])}();